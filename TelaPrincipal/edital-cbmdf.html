<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plano de Estudos - CBMDF</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="icon" type="image/png" href="fotos/logo.png">

    <style>
        /* --- APPLE DESIGN PHILOSOPHY - RESET & GLOBAIS --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            background-color: #000000;
            color: #f5f5f7;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- LAYOUT PRINCIPAL - GRID E ESPAÇAMENTO --- */
        .dashboard-container {
            display: grid;
            grid-template-columns: 240px 1fr 340px;
            height: 100vh;
            gap: 24px;
            padding: 20px;
        }

        /* --- BARRA LATERAL (SIDEBAR) - IDÊNTICA À TELA PRINCIPAL --- */
        .sidebar {
            padding: 10px 0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-user {
            padding: 15px 25px;
            margin-bottom: 10px;
        }

        .sidebar-user h2 {
            font-size: 1.8em;
            font-weight: 600;
            color: #f5f5f7;
            line-height: 50px;
        }

        .sidebar-nav ul {
            list-style: none;
            width: 100%;
            padding: 0 15px;
        }

        .sidebar-nav li a {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 20px;
            color: #8a8a8e;
            text-decoration: none;
            padding: 12px 10px;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
        }

        .sidebar-nav li a i {
            font-size: 1.2em;
            width: 25px;
            text-align: center;
        }

        .sidebar-nav li a span {
            font-size: 1em;
            font-weight: 500;
        }

        /* Cor de hover/ativo no DESKTOP */
        .sidebar-nav li.active a,
        .sidebar-nav li a:hover {
            color: #ffffff;
            background-color: #2c2c2e;
        }

        /* --- FIM DA SIDEBAR --- */

        .main-content,
        .right-column {
            overflow-y: auto;
        }

        .main-content::-webkit-scrollbar {
            width: 8px;
        }

        .main-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .main-content::-webkit-scrollbar-thumb {
            background: #3a3a3c;
            border-radius: 4px;
        }

        .right-column {
            background-color: #1c1c1e;
            border-radius: 16px;
            padding: 25px;
        }

        .right-column::-webkit-scrollbar {
            display: none;
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 2.2em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .page-header p {
            color: #8a8a8e;
            font-size: 1.1em;
        }

        .progress-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .chart-container {
            background-color: #1c1c1e;
            padding: 20px;
            border-radius: 16px;
        }

        .chart-container h4 {
            margin-bottom: 15px;
            font-size: 0.9em;
            font-weight: 500;
            color: #8a8a8e;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .overall-chart h4 {
            font-size: 1.1em;
            color: #f5f5f7;
            font-weight: 600;
        }

        .progress-bar-container {
            background-color: #2c2c2e;
            border-radius: 5px;
            height: 10px;
            width: 100%;
            overflow: hidden;
        }

        .progress-bar {
            background-color: #ff453a;
            height: 100%;
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s ease-in-out;
        }

        .overall-chart .progress-bar {
            background: linear-gradient(90deg, #ff453a, #ff9f0a);
        }

        .progress-label {
            display: block;
            text-align: right;
            font-size: 0.9em;
            font-weight: 600;
            margin-top: 8px;
        }

        .plan-container h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .accordion-item {
            background-color: #1c1c1e;
            border-radius: 16px;
            margin-bottom: 12px;
            overflow: hidden;
            border: 1px solid transparent;
            transition: all 0.3s;
        }

        .accordion-item.current-week {
            border-color: #ff453a;
            box-shadow: 0 0 15px rgba(255, 69, 58, 0.2);
        }

        .accordion-item.active {
            border-color: #3a3a3c;
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .accordion-header:hover {
            background-color: #252527;
        }

        .accordion-header h3 {
            font-size: 1.2em;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .progress-label-semana {
            font-size: 0.8em;
            color: #8a8a8e;
            font-weight: 500;
        }

        .accordion-header .icon {
            transition: transform 0.3s ease;
            color: #8a8a8e;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease, padding 0.5s ease;
            padding: 0 20px;
        }

        .accordion-item.active .accordion-content {
            max-height: 5000px;
            padding: 0 20px 20px;
        }

        .accordion-item.active .accordion-header .icon {
            transform: rotate(45deg);
        }

        .day-plan {
            border-top: 1px solid #3a3a3c;
            padding-top: 20px;
            margin-top: 20px;
        }

        .day-plan:first-child {
            border-top: none;
            margin-top: 0;
        }

        .day-plan h4 {
            margin-bottom: 15px;
            font-weight: 600;
            color: #f5f5f7;
            font-size: 1.1em;
        }

        .day-plan ul {
            list-style: none;
        }

        .topic-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 5px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .topic-item:hover {
            background-color: #2c2c2e;
        }

        .topic-item label {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .topic-item .subject-tag {
            font-size: 0.75em;
            font-weight: 600;
            color: #f5f5f7;
            background-color: #3a3a3c;
            padding: 3px 8px;
            border-radius: 5px;
            margin-top: 5px;
            align-self: flex-start;
        }

        .topic-item input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            flex-shrink: 0;
            width: 22px;
            height: 22px;
            border: 2px solid #3a3a3c;
            border-radius: 50%;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .topic-item input[type="checkbox"]:hover {
            border-color: #8a8a8e;
        }

        .topic-item input[type="checkbox"]:checked {
            background-color: #34c759;
            border-color: #34c759;
        }

        .topic-item input[type="checkbox"]:checked::before {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: #000;
            font-size: 12px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .topic-item.completed label span:first-child {
            color: #8a8a8e;
            text-decoration: line-through;
        }

        .right-column .widget {
            padding: 0;
            background: none;
        }

        .right-column .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .right-column h2 {
            font-size: 1.5em;
        }

        .right-column #current-date {
            font-size: 0.9em;
            color: #8a8a8e;
        }

        .today-widget,
        .lembretes-widget {
            margin-bottom: 25px;
        }

        .today-widget h4,
        .lembretes-widget h4 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 1px solid #3a3a3c;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .today-widget ul,
        .lembretes-widget ul {
            list-style: none;
        }

        .today-widget li,
        .lembretes-widget li {
            padding: 12px 5px;
            border-bottom: 1px solid #3a3a3c;
        }

        .today-widget li:last-child,
        .lembretes-widget li:last-child {
            border-bottom: none;
        }

        .today-widget li strong,
        .lembretes-widget li strong {
            font-weight: 500;
            display: block;
            margin-bottom: 4px;
        }

        .today-widget li span,
        .lembretes-widget li span {
            font-size: 0.85em;
            color: #8a8a8e;
        }

        @media (max-width: 1200px) {
            .dashboard-container {
                grid-template-columns: 90px 1fr;
                grid-template-areas: "sidebar main";
            }

            .sidebar {
                grid-area: sidebar;
            }

            .main-content {
                grid-area: main;
            }

            .right-column {
                display: none;
            }

            .sidebar-nav li a {
                flex-direction: column;
                gap: 8px;
                justify-content: center;
            }

            .sidebar-nav li a span {
                font-size: 0.7em;
            }

            .sidebar-user {
                display: none;
            }
        }

        @media (max-width: 768px) {
            body {
                overflow-y: auto;
            }

            .dashboard-container {
                display: flex;
                flex-direction: column;
                height: auto;
                min-height: 100vh;
                padding: 10px 10px 80px 10px;
            }

            .main-content {
                order: 1;
                overflow-y: visible;
                padding-right: 0;
            }

            .right-column {
                display: block;
                order: 2;
                margin-top: 24px;
            }

            .sidebar {
                order: 3;
                flex-direction: row;
                justify-content: space-around;
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 70px;
                padding: 5px 0;
                z-index: 1000;
                background-color: rgba(28, 28, 30, 0.7);
                backdrop-filter: blur(15px);
                -webkit-backdrop-filter: blur(15px);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .sidebar-nav {
                width: 100%;
            }

            .sidebar-nav ul {
                display: flex;
                justify-content: space-around;
                align-items: center;
                width: 100%;
                padding: 0;
            }

            .sidebar-nav li a span {
                display: none;
            }

            .sidebar-nav li a i {
                font-size: 1.6em;
            }

            .sidebar-nav li.active a,
            .sidebar-nav li a:hover {
                background-color: transparent;
                color: #ff453a;
                /* CORRIGIDO para a cor tema da página */
            }
        }
    </style>

</head>

<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-user">
                <h2>Usuário</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="active">
                        <a href="TelaPrincipal.html">
                            <i class="fa-solid fa-house"></i>
                            <span>Home</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header class="page-header">
                <h1>Plano de Estudos - CBMDF</h1>
                <p>Cronograma de 15 semanas para conquistar sua aprovação.</p>
            </header>

            <section class="progress-panel" id="progress-panel">
                <div class="chart-container overall-chart">
                    <h4>Progresso Geral do Edital</h4>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="geral-progress-bar"></div>
                    </div>
                    <span class="progress-label" id="geral-progress-label">0%</span>
                </div>
            </section>

            <section class="plan-container">
                <h2>Cronograma de Estudos</h2>
                <div id="cronograma-container" class="accordion-container">
                </div>
            </section>
        </main>

        <aside class="right-column">
            <div class="widget today-widget">
                <div class="section-header">
                    <h2>Meu Dia</h2>
                    <span id="current-date"></span>
                </div>
                <h4><i class="fa-solid fa-bullseye"></i> Estudos de Hoje</h4>
                <ul id="today-list">
                </ul>
            </div>
            <div class="widget lembretes-widget">
                <h4><i class="fa-solid fa-star"></i> Lembretes Fixos</h4>
                <ul>
                    <li>
                        <strong>Revisão de Sábado</strong>
                        <span>Revisar os tópicos mais difíceis da semana.</span>
                    </li>
                    <li>
                        <strong>Simulado Quinzenal</strong>
                        <span>Resolver um simulado completo aos domingos, a cada duas semanas.</span>
                    </li>
                    <li>
                        <strong>Lei Seca</strong>
                        <span>Dedicar 15-20 minutos diários para a leitura da legislação.</span>
                    </li>
                </ul>
            </div>
        </aside>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script src="../firebase-init.js"></script>
    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const editalCBMDF = { 'LÍNGUA PORTUGUESA': ['Compreensão e interpretação de textos de gêneros variados.', 'Reconhecimento de tipos e gêneros textuais.', 'Domínio da ortografia oficial: emprego das letras e da acentuação gráfica.', 'Domínio dos mecanismos de coesão textual.', 'Domínio da estrutura morfossintática do período.', 'Reescritura de frases e parágrafos do texto.', 'Correspondência oficial: adequação da linguagem e formato.'], 'MATEMÁTICA': ['Sistemas de unidades de medidas e transformação.', 'Sequências numéricas, progressões aritméticas e geométricas.', 'Geometria analítica: coordenadas, retas, circunferência, elipse, parábola, hipérbole.', 'Análise combinatória e probabilidade.', 'Geometria plana e geometria espacial.', 'Noções de estatística: população, amostra, gráficos, média, mediana, moda, desvio padrão.'], 'QUÍMICA': ['Classificação periódica dos elementos químicos.', 'Radioatividade: emissões, fissão, fusão, riscos e aplicações.', 'Ligações químicas: iônica, covalente, metálica, intermoleculares.', 'Matéria e mudança de estado, separação de misturas.', 'Gases: Teoria cinética, Leis dos gases, misturas gasosas.', 'Termoquímica: reações, entalpia, entropia, energia livre.', 'Eletroquímica: pilhas, eletrólise, corrosão.', 'Tecnologias associadas à química orgânica.'], 'FÍSICA': ['Mecânica: Cinemática, Leis de Newton, trabalho, energia, estática.', 'Termodinâmica: Calor, temperatura, dilatação, gases, leis da termodinâmica.', 'Eletromagnetismo: Carga, campo elétrico, corrente, campo magnético, leis.'], 'BIOLOGIA': ['Ecologia: Relações tróficas, biomas, ciclos, poluição.', 'Saúde, higiene e saneamento básico: doenças transmissíveis e imunidade.'], 'NOÇÕES DE INFORMÁTICA': ['Noções de sistema operacional (Linux e Windows).', 'Edição de textos, planilhas e apresentações (Microsoft Office e BrOffice).', 'Conceitos de Internet e intranet; navegadores e correio eletrônico.', 'Organização e gerenciamento de arquivos, pastas e programas.', 'Segurança da informação: vírus, pragas virtuais, backup.'], 'NOÇÕES DE AGENDA AMBIENTAL': ['Política Nacional de Mudanças no Clima (Lei 12.187/2009).', 'Política Nacional de Resíduos Sólidos (Lei 12.305/2010).', 'Lei Distrital 4.770/2012.', 'Desenvolvimento Sustentável e Agenda Ambiental (A3P).'], 'LEGISLAÇÃO': ['Lei nº 7.479/1986 (Estatuto dos Bombeiros-Militares).', 'Lei nº 8.255/1991 (Organização básica do CBMDF).', 'Lei nº 12.086/2009 (Militares da PMDF e CBMDF).', 'Decreto Federal nº 7.163/2010.', 'Decreto GDF nº 31.817/2010.', 'Decreto-Lei nº 667/1969 (Reorganiza PM e CBM).', 'Lei nº 14.751/2023 (Lei Orgânica Nacional PM e CBM).', 'Lei nº 9.784/99 (Processo administrativo federal).', 'Lei nº 13.709/2018 (LGPD) e Decreto nº 45.771/2024 (LGPD no DF).', 'Lei nº 4.949/2012 (Realidade do DF e RIDE).', 'Lei Orgânica do Distrito Federal.', 'Lei Complementar nº 840/2011 (Servidores públicos civis do DF).'], 'EMERGÊNCIA PRÉ-HOSPITALAR': ['Fundamentos Anatômicos e Fisiológicos.', 'Primeiros Socorros e Suporte Básico de Vida (SBV).', 'Emergências Traumáticas.', 'Urgências e Emergências Clínicas.', 'Saúde Mental e Emergências Psiquiátricas.', 'Urgências Pediátricas e Obstétricas.', 'Atendimento em Desastres e Múltiplas Vítimas.', 'Legislação Aplicada (Portarias MS/GM e SES-DF/CBMDF).'] };
            const cronogramaCBMDF = [{ semana: 1, dias: [{ dia: "Segunda", topicos: [{ id: "leg1", m: "LEGISLAÇÃO", t: 0 }, { id: "lp1", m: "LÍNGUA PORTUGUESA", t: 0 }] }, { dia: "Terça", topicos: [{ id: "eph1", m: "EMERGÊNCIA PRÉ-HOSPITALAR", t: 0 }, { id: "mat1", m: "MATEMÁTICA", t: 0 }] }, { dia: "Quarta", topicos: [{ id: "leg2", m: "LEGISLAÇÃO", t: 1 }, { id: "lp2", m: "LÍNGUA PORTUGUESA", t: 1 }] }, { dia: "Quinta", topicos: [{ id: "eph2", m: "EMERGÊNCIA PRÉ-HOSPITALAR", t: 1 }, { id: "fis1", m: "FÍSICA", t: 0 }] }, { dia: "Sexta", topicos: [{ id: "info1", m: "NOÇÕES DE INFORMÁTICA", t: 0 }, { id: "qui1", m: "QUÍMICA", t: 0 }] }, { dia: "Sábado", topicos: [{ id: "rev1", m: "Revisão", t: "Revisar todos os tópicos da Semana 1" }] }] }, { semana: 2, dias: [{ dia: "Segunda", topicos: [{ id: "leg3", m: "LEGISLAÇÃO", t: 2 }, { id: "lp3", m: "LÍNGUA PORTUGUESA", t: 2 }] }, { dia: "Terça", topicos: [{ id: "eph3", m: "EMERGÊNCIA PRÉ-HOSPITALAR", t: 2 }, { id: "mat2", m: "MATEMÁTICA", t: 1 }] }, { dia: "Quarta", topicos: [{ id: "leg4", m: "LEGISLAÇÃO", t: 3 }, { id: "lp4", m: "LÍNGUA PORTUGUESA", t: 3 }] }, { dia: "Quinta", topicos: [{ id: "eph4", m: "EMERGÊNCIA PRÉ-HOSPITALAR", t: 3 }, { id: "fis2", m: "FÍSICA", t: 1 }] }, { dia: "Sexta", topicos: [{ id: "bio1", m: "BIOLOGIA", t: 0 }, { id: "qui2", m: "QUÍMICA", t: 1 }] }, { dia: "Sábado", topicos: [{ id: "rev2", m: "Revisão", t: "Revisar tópicos + 20 questões" }] }, { dia: "Domingo", topicos: [{ id: "sim1", m: "Simulado", t: "Simulado Parcial (Gerais)" }] }] }, { semana: 3, dias: [{ dia: "Segunda", topicos: [{ id: "leg5", m: "LEGISLAÇÃO", t: 4 }, { id: "lp5", m: "LÍNGUA PORTUGUESA", t: 4 }] }, { dia: "Terça", topicos: [{ id: "eph5", m: "EMERGÊNCIA PRÉ-HOSPITALAR", t: 4 }, { id: "mat3", m: "MATEMÁTICA", t: 2 }] }, { dia: "Quarta", topicos: [{ id: "leg6", m: "LEGISLAÇÃO", t: 5 }, { id: "lp6", m: "LÍNGUA PORTUGUESA", t: 5 }] }, { dia: "Quinta", topicos: [{ id: "eph6", m: "EMERGÊNCIA PRÉ-HOSPITALAR", t: 5 }, { id: "fis3", m: "FÍSICA", t: 2 }] }, { dia: "Sexta", topicos: [{ id: "info2", m: "NOÇÕES DE INFORMÁTICA", t: 1 }, { id: "qui3", m: "QUÍMICA", t: 2 }] }, { dia: "Sábado", topicos: [{ id: "rev3", m: "Revisão", t: "Revisar todos os tópicos da Semana 3" }] }] }, { semana: 4, dias: [{ dia: "Segunda", topicos: [{ id: "leg7", m: "LEGISLAÇÃO", t: 6 }, { id: "lp7", m: "LÍNGUA PORTUGUESA", t: 6 }] }, { dia: "Terça", topicos: [{ id: "eph7", m: "EMERGÊNCIA PRÉ-HOSPITALAR", t: 6 }, { id: "mat4", m: "MATEMÁTICA", t: 3 }] }, { dia: "Quarta", topicos: [{ id: "leg8", m: "LEGISLAÇÃO", t: 7 }, { id: "amb1", m: "NOÇÕES DE AGENDA AMBIENTAL", t: 0 }] }, { dia: "Quinta", topicos: [{ id: "eph8", m: "EMERGÊNCIA PRÉ-HOSPITALAR", t: 7 }, { id: "qui4", m: "QUÍMICA", t: 3 }] }, { dia: "Sexta", topicos: [{ id: "bio2", m: "BIOLOGIA", t: 1 }, { id: "info3", m: "NOÇÕES DE INFORMÁTICA", t: 2 }] }, { dia: "Sábado", topicos: [{ id: "rev4", m: "Revisão", t: "Revisar tópicos + 20 questões" }] }, { dia: "Domingo", topicos: [{ id: "sim2", m: "Simulado", t: "Simulado Parcial (Específicas)" }] }] }, { semana: 5, dias: [{ dia: "Segunda", topicos: [{ id: "leg9", m: "LEGISLAÇÃO", t: 8 }, { id: "qui5", m: "QUÍMICA", t: 4 }] }, { dia: "Terça", topicos: [{ id: "mat5", m: "MATEMÁTICA", t: 4 }, { id: "info4", m: "NOÇÕES DE INFORMÁTICA", t: 3 }] }, { dia: "Quarta", topicos: [{ id: "leg10", m: "LEGISLAÇÃO", t: 9 }, { id: "amb2", m: "NOÇÕES DE AGENDA AMBIENTAL", t: 1 }] }, { dia: "Quinta", topicos: [{ id: "qui6", m: "QUÍMICA", t: 5 }, { id: "mat6", m: "MATEMÁTICA", t: 5 }] }, { dia: "Sexta", topicos: [{ id: "leg11", m: "LEGISLAÇÃO", t: 10 }, { id: "info5", m: "NOÇÕES DE INFORMÁTICA", t: 4 }] }, { dia: "Sábado", topicos: [{ id: "rev5", m: "Revisão", t: "Revisar todos os tópicos da Semana 5" }] }] }, { semana: 6, dias: [{ dia: "Segunda", topicos: [{ id: "leg12", m: "LEGISLAÇÃO", t: 11 }, { id: "qui7", m: "QUÍMICA", t: 6 }] }, { dia: "Terça", topicos: [{ id: "amb3", m: "NOÇÕES DE AGENDA AMBIENTAL", t: 2 }, { id: "qui8", m: "QUÍMICA", t: 7 }] }, { dia: "Quarta", topicos: [{ id: "amb4", m: "NOÇÕES DE AGENDA AMBIENTAL", t: 3 }, { id: "rev_lp", m: "Revisão", t: "Revisão completa de Língua Portuguesa" }] }, { dia: "Quinta", topicos: [{ id: "rev_mat", m: "Revisão", t: "Revisão completa de Matemática" }] }, { dia: "Sexta", topicos: [{ id: "rev_fis_bio", m: "Revisão", t: "Revisão de Física e Biologia" }] }, { dia: "Sábado", topicos: [{ id: "rev6", m: "Revisão", t: "Revisar tópicos + 30 questões" }] }, { dia: "Domingo", topicos: [{ id: "sim3", m: "Simulado", t: "Simulado Completo 1" }] }] }, { semana: 7, dias: [{ dia: "Segunda", topicos: [{ id: "q_leg1", m: "Questões", t: "40 Questões de Legislação" }] }, { dia: "Terça", topicos: [{ id: "q_eph1", m: "Questões", t: "40 Questões de EPH" }] }, { dia: "Quarta", topicos: [{ id: "q_lp1", m: "Questões", t: "40 Questões de Português" }] }, { dia: "Quinta", topicos: [{ id: "q_mat1", m: "Questões", t: "40 Questões de Matemática" }] }, { dia: "Sexta", topicos: [{ id: "q_div1", m: "Questões", t: "50 Questões (Química, Física, Info)" }] }, { dia: "Sábado", topicos: [{ id: "rev7", m: "Revisão", t: "Corrigir e revisar questões da semana" }] }] }, { semana: 8, dias: [{ dia: "Segunda", topicos: [{ id: "q_leg2", m: "Questões", t: "Foco nos erros: Legislação" }] }, { dia: "Terça", topicos: [{ id: "q_eph2", m: "Questões", t: "Foco nos erros: EPH" }] }, { dia: "Quarta", topicos: [{ id: "q_lp2", m: "Questões", t: "Foco nos erros: Português" }] }, { dia: "Quinta", topicos: [{ id: "q_mat2", m: "Questões", t: "Foco nos erros: Matemática" }] }, { dia: "Sexta", topicos: [{ id: "q_div2", m: "Questões", t: "Foco nos erros: Demais matérias" }] }, { dia: "Sábado", topicos: [{ id: "rev8", m: "Revisão", t: "Revisão geral com base nos erros" }] }, { dia: "Domingo", topicos: [{ id: "sim4", m: "Simulado", t: "Simulado Completo 2" }] }] }, { semana: 9, dias: [{ dia: "Segunda", topicos: [{ id: "sim4_rev", m: "Revisão", t: "Análise detalhada do Simulado 2" }] }, { dia: "Terça", topicos: [{ id: "rev_geral_leg", m: "Revisão", t: "Revisão geral: Legislação" }] }, { dia: "Quarta", topicos: [{ id: "rev_geral_eph", m: "Revisão", t: "Revisão geral: EPH" }] }, { dia: "Quinta", topicos: [{ id: "rev_geral_lp", m: "Revisão", t: "Revisão geral: Português" }] }, { dia: "Sexta", topicos: [{ id: "rev_geral_mat", m: "Revisão", t: "Revisão geral: Matemática" }] }, { dia: "Sábado", topicos: [{ id: "rev9", m: "Revisão", t: "Revisão dos pontos mais fracos" }] }] }, { semana: 10, dias: [{ dia: "Segunda", topicos: [{ id: "q_leg3", m: "Questões", t: "Prova CBMDF/PMDF antiga" }] }, { dia: "Terça", topicos: [{ id: "q_gerais1", m: "Questões", t: "Prova de outra banca (Gerais)" }] }, { dia: "Quarta", topicos: [{ id: "q_especificas1", m: "Questões", t: "Prova de outra banca (Específicas)" }] }, { dia: "Quinta", topicos: [{ id: "rev_flashcards", m: "Revisão", t: "Revisão por flashcards/mapas mentais" }] }, { dia: "Sexta", topicos: [{ id: "rev_lei_seca", m: "Revisão", t: "Leitura de Lei Seca (Legislação)" }] }, { dia: "Sábado", topicos: [{ id: "rev10", m: "Revisão", t: "Revisão dos tópicos com >50% de erro" }] }, { dia: "Domingo", topicos: [{ id: "sim5", m: "Simulado", t: "Simulado Completo 3" }] }] }, { semana: 11, dias: [{ dia: "Segunda", topicos: [{ id: "sim5_rev", m: "Revisão", t: "Análise detalhada do Simulado 3" }] }, { dia: "Terça", topicos: [{ id: "rev11_1", m: "Revisão", t: "Revisão de fórmulas e regras (Exatas e PT)" }] }, { dia: "Quarta", topicos: [{ id: "rev11_2", m: "Revisão", t: "Revisão de protocolos e portarias (EPH)" }] }, { dia: "Quinta", topicos: [{ id: "rev11_3", m: "Revisão", t: "Revisão das leis mais importantes (Legislação)" }] }, { dia: "Sexta", topicos: [{ id: "rev11_4", m: "Revisão", t: "Revisão de matérias menores (Bio, Info, Amb.)" }] }, { dia: "Sábado", topicos: [{ id: "rev11", m: "Revisão", t: "Revisão livre dos pontos que sentir necessidade" }] }] }, { semana: 12, dias: [{ dia: "Segunda", topicos: [{ id: "rev12_1", m: "Revisão", t: "Revisão focada em Legislação" }] }, { dia: "Terça", topicos: [{ id: "rev12_2", m: "Revisão", t: "Revisão focada em EPH" }] }, { dia: "Quarta", topicos: [{ id: "rev12_3", m: "Revisão", t: "Revisão focada em Português" }] }, { dia: "Quinta", topicos: [{ id: "rev12_4", m: "Revisão", t: "Revisão focada em Exatas" }] }, { dia: "Sexta", topicos: [{ id: "rev12_5", m: "Revisão", t: "Revisão final das demais" }] }, { dia: "Sábado", topicos: [{ id: "rev12", m: "Revisão", t: "Revisão de anotações e planejamento" }] }, { dia: "Domingo", topicos: [{ id: "sim6", m: "Simulado", t: "Simulado Final 1" }] }] }, { semana: 13, dias: [{ dia: "Segunda", topicos: [{ id: "sim6_rev", m: "Revisão", t: "Análise detalhada do Simulado Final 1" }] }, { dia: "Terça", topicos: [{ id: "rev13_1", m: "Revisão", t: "Releitura de resumos e mapas mentais" }] }, { dia: "Quarta", topicos: [{ id: "rev13_2", m: "Revisão", t: "Revisão de Lei Seca (principais artigos)" }] }, { dia: "Quinta", topicos: [{ id: "rev13_3", m: "Revisão", t: "Revisão de fórmulas e conceitos-chave" }] }, { dia: "Sexta", topicos: [{ id: "rev13_4", m: "Revisão", t: "Revisão geral dos pontos com maior dificuldade" }] }, { dia: "Sábado", topicos: [{ id: "rev13", m: "Revisão", t: "Revisão livre dos pontos que sentir necessidade" }] }, { dia: "Domingo", topicos: [{ id: "sim7", m: "Simulado", t: "Simulado Final 2" }] }] }, { semana: 14, dias: [{ dia: "Segunda", topicos: [{ id: "sim7_rev", m: "Revisão", t: "Análise detalhada do Simulado Final 2" }] }, { dia: "Terça", topicos: [{ id: "rev14_1", m: "Revisão Final", t: "Revisão geral de Legislação Pertinente ao CBMDF." }] }, { dia: "Quarta", topicos: [{ id: "rev14_2", m: "Revisão Final", t: "Revisão geral de Emergência Pré-Hospitalar." }] }, { dia: "Quinta", topicos: [{ id: "rev14_3", m: "Revisão Final", t: "Revisão geral de Língua Portuguesa." }] }, { dia: "Sexta", topicos: [{ id: "rev14_4", m: "Revisão Final", t: "Revisão geral de Matemática e Exatas." }] }, { dia: "Sábado", topicos: [{ id: "rev14_5", m: "Revisão Final", t: "Revisão das anotações finais e descanso." }] }, { dia: "Domingo", topicos: [{ id: "descanso1", m: "Descanso", t: "Descanso pré-semana da prova." }] }] }, { semana: 15, dias: [{ dia: "Segunda", topicos: [{ id: "rev15_1", m: "Revisão de Véspera", t: "Leitura de pontos-chave e artigos importantes" }] }, { dia: "Terça", topicos: [{ id: "rev15_2", m: "Revisão de Véspera", t: "Leitura de fórmulas e conceitos principais" }] }, { dia: "Quarta", topicos: [{ id: "rev15_3", m: "Revisão de Véspera", t: "Leitura de mapas mentais e resumos" }] }, { dia: "Quinta", topicos: [{ id: "rev15_4", m: "Revisão de Véspera", t: "Revisão leve dos tópicos mais difíceis" }] }, { dia: "Sexta", topicos: [{ id: "rev15_5", m: "Revisão de Véspera", t: "Separar material e documentos para a prova" }] }, { dia: "Sábado", topicos: [{ id: "descanso_final", m: "Descanso Total", t: "Descanse a mente e o corpo. Confie na sua preparação." }] }, { dia: "Domingo", topicos: [{ id: "prova", m: "Dia da Prova", t: "Boa sorte! Dia de colocar todo o esforço em prática." }] }] }];

            const cronogramaContainer = document.getElementById('cronograma-container');
            const progressPanel = document.getElementById('progress-panel');
            const todayList = document.getElementById('today-list');
            const currentDateEl = document.getElementById('current-date');

            const currentUserEmail = "default_user@cbmdf.com";
            const progressKey = `studyProgressCBMDF_${currentUserEmail}`;

            let progress = JSON.parse(localStorage.getItem(progressKey)) || {};
            let totalTopics = 0;

            function saveProgress() {
                localStorage.setItem(progressKey, JSON.stringify(progress));
            }

            // FUNÇÃO RENDER CORRIGIDA E OTIMIZADA
            function renderCronograma(currentWeekIndex) {
                cronogramaContainer.innerHTML = '';
                totalTopics = 0;

                cronogramaCBMDF.forEach((semanaData, index) => {
                    const semanaEl = document.createElement('div');
                    semanaEl.className = 'accordion-item';
                    semanaEl.dataset.weekIndex = index;

                    if (index === currentWeekIndex) {
                        semanaEl.classList.add('current-week');
                    }

                    const contentHtml = semanaData.dias.map(diaData => {
                        const diaTopics = diaData.topicos.map(topic => {
                            let isCountable = typeof topic.t === 'number' && editalCBMDF[topic.m] && editalCBMDF[topic.m][topic.t];
                            if (isCountable) {
                                totalTopics++;
                            }

                            const topicText = isCountable ? editalCBMDF[topic.m][topic.t] : topic.t;
                            const isCompleted = progress[topic.id] ? 'completed' : '';
                            const isChecked = progress[topic.id] ? 'checked' : '';

                            return `<li class="topic-item ${isCompleted}" data-id="${topic.id}"><input type="checkbox" id="${topic.id}" ${isChecked}><label for="${topic.id}"><span>${topicText}</span><span class="subject-tag">${topic.m}</span></label></li>`;
                        }).join('');
                        return `<div class="day-plan"><h4>${diaData.dia}</h4><ul>${diaTopics}</ul></div>`;
                    }).join('');

                    // A lógica de cálculo foi removida daqui para evitar repetição e bugs.
                    // Agora, apenas a estrutura HTML é criada.
                    semanaEl.innerHTML = `
                    <div class="accordion-header">
                        <h3>Semana ${semanaData.semana} <span class="progress-label-semana"></span></h3>
                        <i class="fas fa-plus icon"></i>
                    </div>
                    <div class="accordion-content">${contentHtml}</div>`;

                    cronogramaContainer.appendChild(semanaEl);
                    // A função updateWeekProgress é chamada para CADA semana, garantindo que o % inicial esteja correto.
                    updateWeekProgress(semanaEl);
                });
            }

            // FUNÇÃO DE ATUALIZAÇÃO CORRIGIDA
            function updateWeekProgress(semanaEl) {
                const weekIndex = parseInt(semanaEl.dataset.weekIndex, 10);
                const semanaData = cronogramaCBMDF[weekIndex];
                if (!semanaData) return;

                let semanaTopics = 0;
                let semanaCompleted = 0;

                semanaData.dias.forEach(dia => {
                    dia.topicos.forEach(topic => {
                        // A CONDIÇÃO 'if (typeof topic.t === 'number')' FOI REMOVIDA DAQUI
                        // para que todos os itens (matérias, revisões, etc.) sejam contados.
                        semanaTopics++;
                        if (progress[topic.id]) {
                            semanaCompleted++;
                        }
                    });
                });

                // Lógica de cálculo unificada e corrigida.
                const progressLabel = semanaEl.querySelector('.progress-label-semana');
                if (semanaTopics > 0) {
                    const semanaProgress = Math.round((semanaCompleted / semanaTopics) * 100);
                    progressLabel.textContent = `(${semanaProgress}%)`;
                } else {
                    // Caso uma semana não tenha tópicos, não exibe nada.
                    progressLabel.textContent = '';
                }
            }

            // ===== INÍCIO DA FUNÇÃO CORRIGIDA =====
            function updateCharts() {
                // 1. Identificar todas as matérias e atividades únicas do cronograma
                const allMateriasFromCronograma = [...new Set(
                    cronogramaCBMDF.flatMap(semana =>
                        semana.dias.flatMap(dia =>
                            dia.topicos.map(topic => topic.m)
                        )
                    )
                )];

                // Lista de atividades que não devem gerar um card de progresso
                const materiasToIgnore = ['Descanso', 'Descanso Total', 'Dia da Prova', 'Descanso pré-semana da prova.'];

                const completedCountableTopics = Object.keys(progress).filter(id => {
                    let isCountable = false;
                    cronogramaCBMDF.forEach(s => s.dias.forEach(d => d.topicos.forEach(t => {
                        if (t.id === id && typeof t.t === 'number') { isCountable = true; }
                    })));
                    return isCountable;
                }).length;

                const overallPercentage = totalTopics > 0 ? Math.round((completedCountableTopics / totalTopics) * 100) : 0;

                document.getElementById('geral-progress-bar').style.width = `${overallPercentage}%`;
                document.getElementById('geral-progress-label').textContent = `${overallPercentage}%`;

                const existingCharts = progressPanel.querySelectorAll('.chart-container:not(.overall-chart)');
                existingCharts.forEach(chart => chart.remove());

                // Laço corrigido para usar a lista completa de matérias do cronograma
                allMateriasFromCronograma.forEach(materia => {
                    // Ignora os cards que não fazem sentido ter progresso
                    if (materiasToIgnore.includes(materia)) {
                        return;
                    }

                    let totalMateria = 0, completedMateria = 0;
                    cronogramaCBMDF.forEach(s => s.dias && s.dias.forEach(d => d.topicos.forEach(t => {
                        // A lógica de contagem agora se aplica a qualquer 'materia' do laço
                        if (t.m === materia) {
                            totalMateria++;
                            if (progress[t.id]) completedMateria++;
                        }
                    })));

                    if (totalMateria > 0) {
                        const materiaPercentage = Math.round((completedMateria / totalMateria) * 100);
                        const chartEl = document.createElement('div');
                        chartEl.className = 'chart-container';
                        chartEl.innerHTML = `<h4>${materia}</h4><div class="progress-bar-container"><div class="progress-bar" style="width: ${materiaPercentage}%;"></div></div><span class="progress-label">${materiaPercentage}%</span>`;
                        progressPanel.appendChild(chartEl);
                    }
                });
            }
            // ===== FIM DA FUNÇÃO CORRIGIDA =====

            function renderTodayStudies(currentWeekIndex) {
                const today = new Date();
                const dayOfWeekName = today.toLocaleDateString('pt-BR', { weekday: 'long' });
                const dayOfWeek = dayOfWeekName.charAt(0).toUpperCase() + dayOfWeekName.slice(1).replace('-feira', '');

                currentDateEl.textContent = today.toLocaleDateString('pt-BR', { day: '2-digit', month: 'long' });

                if (currentWeekIndex >= 0 && currentWeekIndex < cronogramaCBMDF.length) {
                    const currentWeek = cronogramaCBMDF[currentWeekIndex];
                    if (currentWeek && currentWeek.dias) {
                        const todayPlan = currentWeek.dias.find(d => d.dia === dayOfWeek);
                        if (todayPlan) {
                            todayList.innerHTML = todayPlan.topicos.map(topic => {
                                const topicText = (typeof topic.t === 'number' && editalCBMDF[topic.m]) ? editalCBMDF[topic.m][topic.t] : topic.t;
                                return `<li><strong>${topic.m}:</strong> <span>${topicText}</span></li>`
                            }).join('');
                            return;
                        }
                    }
                }
                todayList.innerHTML = '<li>Nenhum estudo agendado para hoje. Aproveite para descansar ou revisar.</li>';
            }

            cronogramaContainer.addEventListener('click', (e) => {
                const header = e.target.closest('.accordion-header');
                if (header) {
                    header.parentElement.classList.toggle('active');
                    return;
                }

                const checkbox = e.target.closest('input[type="checkbox"]');
                if (checkbox) {
                    const id = checkbox.id;
                    const topicItem = checkbox.closest('.topic-item');
                    const semanaItem = checkbox.closest('.accordion-item');

                    if (checkbox.checked) {
                        progress[id] = true;
                        topicItem.classList.add('completed');
                    } else {
                        delete progress[id];
                        topicItem.classList.remove('completed');
                    }
                    saveProgress();

                    updateWeekProgress(semanaItem);
                    updateCharts();
                }
            });

            const startDate = new Date('2025-08-18T00:00:00');
            const today = new Date();
            const oneDay = 1000 * 60 * 60 * 24;
            const diffTime = today - startDate;
            const currentWeekIndex = Math.floor(diffTime / (oneDay * 7));

            renderCronograma(currentWeekIndex);
            updateCharts();
            renderTodayStudies(currentWeekIndex);

            if (currentWeekIndex >= 0 && currentWeekIndex < cronogramaCBMDF.length) {
                const currentWeekEl = cronogramaContainer.querySelector(`[data-week-index="${currentWeekIndex}"]`);
                if (currentWeekEl) {
                    currentWeekEl.classList.add('active');
                }
            }
        });
    </script>
</body>

</html>